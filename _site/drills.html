<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Drills and Games</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./whitebelt.html"> 
<span class="menu-text">White Belt</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./drills.html" aria-current="page"> 
<span class="menu-text">Drills and Games</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./butterfly.html"> 
<span class="menu-text">Butterfly Guard Passes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./systems.html"> 
<span class="menu-text">Systems</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./selfdefence.html"> 
<span class="menu-text">Self Defence</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#solo-turtle-drill" id="toc-solo-turtle-drill" class="nav-link active" data-scroll-target="#solo-turtle-drill">Solo turtle drill</a></li>
  <li><a href="#grip-fighting-drill-no-gi" id="toc-grip-fighting-drill-no-gi" class="nav-link" data-scroll-target="#grip-fighting-drill-no-gi">Grip fighting drill (no-gi)</a></li>
  <li><a href="#push-pull-drill-from-butterfly-guard" id="toc-push-pull-drill-from-butterfly-guard" class="nav-link" data-scroll-target="#push-pull-drill-from-butterfly-guard">Push-pull drill from butterfly guard</a>
  <ul class="collapse">
  <li><a href="#pull---idiot-sweep" id="toc-pull---idiot-sweep" class="nav-link" data-scroll-target="#pull---idiot-sweep">Pull - Idiot Sweep</a></li>
  <li><a href="#push" id="toc-push" class="nav-link" data-scroll-target="#push">Push</a></li>
  <li><a href="#exercise-to-strengthen-for-this" id="toc-exercise-to-strengthen-for-this" class="nav-link" data-scroll-target="#exercise-to-strengthen-for-this">Exercise (to strengthen for this)</a></li>
  <li><a href="#follow-up-to-pull" id="toc-follow-up-to-pull" class="nav-link" data-scroll-target="#follow-up-to-pull">Follow-up to pull</a></li>
  </ul></li>
  <li><a href="#moving-around-in-butterfly-guard-drill" id="toc-moving-around-in-butterfly-guard-drill" class="nav-link" data-scroll-target="#moving-around-in-butterfly-guard-drill">Moving around in butterfly guard drill</a></li>
  <li><a href="#no-gi-butterfly-guard-game-against-kneeling-opponent" id="toc-no-gi-butterfly-guard-game-against-kneeling-opponent" class="nav-link" data-scroll-target="#no-gi-butterfly-guard-game-against-kneeling-opponent">No-gi butterfly guard game against kneeling opponent</a></li>
  <li><a href="#dance-pass-drill" id="toc-dance-pass-drill" class="nav-link" data-scroll-target="#dance-pass-drill">“Dance pass” drill</a>
  <ul class="collapse">
  <li><a href="#simple-dance-pass" id="toc-simple-dance-pass" class="nav-link" data-scroll-target="#simple-dance-pass">Simple “dance pass”</a></li>
  <li><a href="#leg-feints" id="toc-leg-feints" class="nav-link" data-scroll-target="#leg-feints">Leg feints</a></li>
  <li><a href="#feet-on-hips-drill" id="toc-feet-on-hips-drill" class="nav-link" data-scroll-target="#feet-on-hips-drill">Feet on hips drill</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Drills and Games</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="solo-turtle-drill" class="level2">
<h2 class="anchored" data-anchor-id="solo-turtle-drill">Solo turtle drill</h2>
<ul>
<li>Start in turtle position, forehead on floor, arms protecting head</li>
<li>Move one arm outwards, placing palm on the floor, elbow up</li>
<li>Sit through to the side opposite that arm, rotating through 90 degrees (if you had an opponent, you would now be facing into them).</li>
<li>You are now more or less in butterfly guard</li>
<li>Make sure your feet are tucked in properly so that your hands can guard them (not feet together)</li>
<li>Now tuck one knee close to your body (the opposite knee to the arm you just used)</li>
<li>Push yourself upwards with a hip thrust so that you are now on one knee and one foot</li>
<li>Move back into turtle position and start again (going the other way, back to the direction you started in)</li>
<li>This is good for core strength and can be done in a small space</li>
</ul>
</section>
<section id="grip-fighting-drill-no-gi" class="level2">
<h2 class="anchored" data-anchor-id="grip-fighting-drill-no-gi">Grip fighting drill (no-gi)</h2>
<ul>
<li>We learned this drill in January 2024 (week 3 of training)</li>
<li>One participant sits in butterfly guard (knees apart and bent, feet somewhat towards your body, core engaged, back curved)</li>
<li>Participant 2 is standing with right foot forward, ready to drive forward from the ball of the back foot</li>
<li>The aim of the game for standing participant is to do one of 3 things:
<ul>
<li>Push sitting participant over with a quick shove to the shoulders (must be firm)</li>
<li>Tip sitting participant over by grabbing their heels and lifting</li>
<li>Place pressure on sitting participant’s knees</li>
</ul></li>
<li>The aim of the game for the sitting participant is to do one of 3 things:
<ul>
<li>Grab both wrists of standing participant: either under, over, or one of each (depending on position)</li>
<li>Grab one wrist of standing participant with both hands (baseball bat grip)</li>
<li>Grab one wrist and the same upper arm in a bent position (this is the strongest position)</li>
</ul></li>
<li>Can move from one position to another</li>
<li>Do not CHEAT as standing participant by hiding your hands (sitting participant could then grab your feet/ankles)</li>
</ul>
</section>
<section id="push-pull-drill-from-butterfly-guard" class="level2">
<h2 class="anchored" data-anchor-id="push-pull-drill-from-butterfly-guard">Push-pull drill from butterfly guard</h2>
<ul>
<li>This follows on from the previous game</li>
<li>This is more a drill than a game</li>
<li>Start from the point where you have a double-wrist grip from butterfly</li>
<li>It doesn’t have to be a double-wrist grip! Single-wrist will work!</li>
<li>Bottom person pulls on the standing person’s wrists</li>
<li>Standing person reacts by stepping forward, crouching down somewhat</li>
</ul>
<section id="pull---idiot-sweep" class="level3">
<h3 class="anchored" data-anchor-id="pull---idiot-sweep">Pull - Idiot Sweep</h3>
<ul>
<li>This works when the standing person then reacts by pulling back</li>
<li>From butterfly, hook the standing person’s ankles with your feet</li>
<li>Don’t sit back</li>
<li>Keep the feet active, in contact with their heels</li>
<li>Then push on their knees (use body, not just arms)</li>
<li>Standing person will fall backwards</li>
</ul>
</section>
<section id="push" class="level3">
<h3 class="anchored" data-anchor-id="push">Push</h3>
<ul>
<li>This works when standing person does not pull back</li>
<li>Keep hold of their right wrist; with your left hand, grab their upper right leg</li>
<li>Pull yourself under their hips (do NOT fall backwards yet)</li>
<li>Let go of the wrist</li>
<li>Hook your left foot up behind their right leg, up around their hip</li>
<li>To do this you have gone onto your back and lifted your hips upwards</li>
<li>Twisting around somewhat, pinch their leg between yours (your right leg is at the front)</li>
<li>Grab your left butt cheek around their ankle to squeeze the leg in</li>
<li>To sweep them, lift and twist sideways</li>
<li>Need core strength for this! Do the drill!</li>
</ul>
</section>
<section id="exercise-to-strengthen-for-this" class="level3">
<h3 class="anchored" data-anchor-id="exercise-to-strengthen-for-this">Exercise (to strengthen for this)</h3>
<ul>
<li>Lie on your back with your legs elevated about 90 degrees, hands on ground at side</li>
<li>Reach your feet up towards the ceiling, lifting your hips up from the ground</li>
<li>Do this at least 15 times</li>
<li>Repeat 2-4 times a day</li>
<li>Variation: Try pushing up as if moving into single-leg X (both sides)</li>
<li>Variation: Without hands on ground, lift hips and rotate sideways. Keep doing this round 360 degrees</li>
</ul>
</section>
<section id="follow-up-to-pull" class="level3">
<h3 class="anchored" data-anchor-id="follow-up-to-pull">Follow-up to pull</h3>
<ul>
<li>In the event that your standing opponent resists your push and steps over your ankle hook:</li>
<li>Grab the heel of their foot (the one that has stepped over) and lift it</li>
<li>If they fall over, great!</li>
<li>Otherwise, react to what they do:
<ul>
<li>Maybe move straight into single-leg X?</li>
<li>Otherwise, stand up and keep hold of the foot</li>
</ul></li>
</ul>
</section>
</section>
<section id="moving-around-in-butterfly-guard-drill" class="level2">
<h2 class="anchored" data-anchor-id="moving-around-in-butterfly-guard-drill">Moving around in butterfly guard drill</h2>
<ul>
<li>The great strength of butterfly is the flexibility it gives you to move</li>
<li>Practice moving around from butterfly
<ul>
<li>With one hand behind you, the other between you and your imaginary opponent, move around</li>
<li>Move around with fists on floor, but keep leaning forwards</li>
<li>“Levitate” by moving forwards or around without using hands at all</li>
</ul></li>
</ul>
</section>
<section id="no-gi-butterfly-guard-game-against-kneeling-opponent" class="level2">
<h2 class="anchored" data-anchor-id="no-gi-butterfly-guard-game-against-kneeling-opponent">No-gi butterfly guard game against kneeling opponent</h2>
<ul>
<li>From butterfly, hook your feet under their knees</li>
<li>Must be close enough to guard your feet with your hands</li>
<li>Grab their wrist and under their arm at the top (same arm - bent)</li>
<li>Put your opposite foot (usually R) on their knee</li>
<li>Pull them forwards so that they fall over your knee</li>
<li>TBC</li>
</ul>
</section>
<section id="dance-pass-drill" class="level2">
<h2 class="anchored" data-anchor-id="dance-pass-drill">“Dance pass” drill</h2>
<ul>
<li>Your opponent starts on their back with their knees into their chest, in defensive pose</li>
<li>You are standing, right foot forward, knees bent, ready to pass</li>
<li>Leaning slightly forward but staying balanced, put your hands on your opponent’s shins, putting your weight into it so they can’t just free their legs</li>
</ul>
<section id="simple-dance-pass" class="level3">
<h3 class="anchored" data-anchor-id="simple-dance-pass">Simple “dance pass”</h3>
<ul>
<li>Step your left foot outward, swing the right one slightly back (to avoid getting caught on their foot) and bring it round near their hip, then step the left foot forward, ready to move into knee ride (or similar)</li>
<li>This can also be done the other way round - less need to swing back with left foot since it’s already back</li>
<li>One, two, three</li>
<li>Be precise with foot placement</li>
<li>This is the only one you really need to know for white belt</li>
</ul>
</section>
<section id="leg-feints" class="level3">
<h3 class="anchored" data-anchor-id="leg-feints">Leg feints</h3>
<ul>
<li><p>Version 1: Move their legs in the same direction you are stepping: left - right - left and then throw aside as you go into the pass - so this is still 1 - 2 - 3</p></li>
<li><p>Version 2: Move legs first, THEN step, so 1 - 2 - 3 - 4. Don’t think too hard about this one or you’ll get screwed up</p></li>
<li><p>Version 3: Move legs back and forth instead of left and right.</p></li>
<li><p>Version 4: If they push up to try and put their legs on your hips, you can do the classic bullfighter’s pass - push against them slightly then fling the legs aside like a bullfighter’s cape as you pass.</p></li>
</ul>
</section>
<section id="feet-on-hips-drill" class="level3">
<h3 class="anchored" data-anchor-id="feet-on-hips-drill">Feet on hips drill</h3>
<ul>
<li>Start with the bottom person feet-on-hips with good grips (lapel and wrist)</li>
<li>Top person’s aim is to break the grips and get hands on their shins</li>
<li>Can break lapel grip by grabbing around wrist with both hands and punching forwards</li>
<li>Can break wrist grip by circling wrist</li>
<li>Aim - push their knees towards their chest</li>
<li>Bottom person’s main aim is to retain their grips and keep feet on hips</li>
<li>This is the main person the drill is for</li>
<li>To get your feet back on their hips (that they have pushed away with your shins) - karate-kick outwards beyond their hip (on the side where you have the lapel grip)</li>
<li>This will get rid of their hand and you can put the foot back on the hip</li>
<li>To get rid of the other hand (on the side where you have the sleeve grip), pull the hand to one side, hook foot behind their knee</li>
<li>As they move to counter this, put foot back on hip</li>
<li>Make sure you don’t push away too strongly and straighten your legs - then they will just pass!</li>
<li>It’s a push-pull. Keep your knees above your hips.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>