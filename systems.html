<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./whitebelt.html"> 
<span class="menu-text">White Belt</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./drills.html"> 
<span class="menu-text">Drills and Games</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./butterfly.html"> 
<span class="menu-text">Butterfly Guard Passes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./systems.html" aria-current="page"> 
<span class="menu-text">Systems</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#attacks-from-closed-guard" id="toc-attacks-from-closed-guard" class="nav-link" data-scroll-target="#attacks-from-closed-guard">Attacks from closed guard</a>
  <ul class="collapse">
  <li><a href="#arm-bar" id="toc-arm-bar" class="nav-link" data-scroll-target="#arm-bar">Arm bar</a></li>
  <li><a href="#flower-sweep" id="toc-flower-sweep" class="nav-link" data-scroll-target="#flower-sweep">Flower sweep</a></li>
  <li><a href="#cross-collar-choke" id="toc-cross-collar-choke" class="nav-link" data-scroll-target="#cross-collar-choke">Cross-collar choke</a></li>
  </ul></li>
  <li><a href="#attacks-from-knee-ride" id="toc-attacks-from-knee-ride" class="nav-link" data-scroll-target="#attacks-from-knee-ride">Attacks from knee ride</a>
  <ul class="collapse">
  <li><a href="#far-knee-spinning-arm-bar" id="toc-far-knee-spinning-arm-bar" class="nav-link" data-scroll-target="#far-knee-spinning-arm-bar">Far knee (spinning arm bar)</a></li>
  <li><a href="#close-knee" id="toc-close-knee" class="nav-link" data-scroll-target="#close-knee">Close knee</a></li>
  <li><a href="#cross-collar-choke-1" id="toc-cross-collar-choke-1" class="nav-link" data-scroll-target="#cross-collar-choke-1">Cross-collar choke</a></li>
  </ul></li>
  <li><a href="#head-lock-escapes" id="toc-head-lock-escapes" class="nav-link" data-scroll-target="#head-lock-escapes">Head lock escapes</a>
  <ul class="collapse">
  <li><a href="#if-they-havent-got-you-bent-over-too-much" id="toc-if-they-havent-got-you-bent-over-too-much" class="nav-link" data-scroll-target="#if-they-havent-got-you-bent-over-too-much">If they haven’t got you bent over too much</a></li>
  <li><a href="#if-theyve-got-you-bent-right-over" id="toc-if-theyve-got-you-bent-right-over" class="nav-link" data-scroll-target="#if-theyve-got-you-bent-right-over">If they’ve got you bent right over</a></li>
  </ul></li>
  <li><a href="#feet-on-hips" id="toc-feet-on-hips" class="nav-link" data-scroll-target="#feet-on-hips">Feet on hips</a>
  <ul class="collapse">
  <li><a href="#double-ankle-sweep" id="toc-double-ankle-sweep" class="nav-link" data-scroll-target="#double-ankle-sweep">Double ankle sweep</a></li>
  <li><a href="#tripod-sweep" id="toc-tripod-sweep" class="nav-link" data-scroll-target="#tripod-sweep">Tripod sweep</a></li>
  <li><a href="#triangle-choke" id="toc-triangle-choke" class="nav-link" data-scroll-target="#triangle-choke">Triangle choke</a></li>
  <li><a href="#omoplata" id="toc-omoplata" class="nav-link" data-scroll-target="#omoplata">Omoplata</a></li>
  <li><a href="#arm-bar-1" id="toc-arm-bar-1" class="nav-link" data-scroll-target="#arm-bar-1">Arm bar</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Systems</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="background" class="level1">
<h1>Background</h1>
<p>Here I will document some rudimentary systems for attacks and sweeps that Tim is showing us</p>
<section id="attacks-from-closed-guard" class="level2">
<h2 class="anchored" data-anchor-id="attacks-from-closed-guard">Attacks from closed guard</h2>
<ul>
<li>First, get your grips. Right hand goes into their sleeve in a pistol grip, thumb inside</li>
<li>Left hand reaches across under their arm, grabbing the seam so you have a good hold</li>
<li>While you’re doing this, keep them down firmly with your knees!</li>
<li>Lift your hips quickly to jolt them</li>
<li>As you do this, pull their arm firmly with your right hand to try and get it across your hips</li>
</ul>
<section id="arm-bar" class="level3">
<h3 class="anchored" data-anchor-id="arm-bar">Arm bar</h3>
<ul>
<li>Use this one when you can get their arm straight across your hips</li>
<li>Lift your hips again and swing your left leg up over their shoulder as you move your body to the right</li>
<li>You can use your other leg against them as leverage</li>
<li>Quickly cross your ankles again if you can</li>
<li>Now you can let go of their armpit and push their head down under your leg as you shift your body a bit further across</li>
<li>Bring your hands both to their wrist, grasping wrist to your chest, pulling their arm straight</li>
<li>Your thumbs are pointing up</li>
<li>Left leg scissors down over their head so it’s grasping the head, knee points up</li>
<li>Now lift your hips in the direction your knee is pointing, UP. Do NOT ease pressure on the wrist</li>
<li>You should get a tap quite easily. If not, have you eased the wrist?</li>
</ul>
</section>
<section id="flower-sweep" class="level3">
<h3 class="anchored" data-anchor-id="flower-sweep">Flower sweep</h3>
<ul>
<li>Use this one when you DON’T get the arm all the way across AND they move forward and put their weight on you (e.g.&nbsp;their hand on your bicep)</li>
<li>Keeping your grip on their armpit, let go the sleeve and reach around with your right hand to grab their gi at the knee</li>
<li>Put your left foot on the floor. Use this to push your body around to the right.</li>
<li>Kick your right leg upwards towards the ceiling, sweeping them over as you do this so that you land in mount</li>
<li>Ben says this is the best sweep to try on your lover! It is quite fun.</li>
<li><a href="https://jiujitsulegacy.com/videos/how-to-flower-sweep-from-closed-guard/">This is a reasonable approximation of this sweep</a>, although with slightly different grips.</li>
</ul>
</section>
<section id="cross-collar-choke" class="level3">
<h3 class="anchored" data-anchor-id="cross-collar-choke">Cross-collar choke</h3>
<ul>
<li>Use this one where they don’t do anything after you get your grips</li>
<li>OK, you wanna be choked then!</li>
<li>Reach up with your right hand and get a REALLY good grip on their gi, as far up as you can go behind their neck</li>
<li>Now move your body and arm slightly to the right, forcing their neck upwards so you can reach under with your left hand</li>
<li>Get a really good grip with your left hand as far up as you can go on the other side of their collar</li>
<li>Now turn your palms UPWARDS, forcing your thumb-knuckles into their neck</li>
<li>Now pull your elbows DOWN towards the ground (as if they can go through the ground), crunching up slightly but not too much (it’s mainly about bringing the elbows down, keeping them IN)</li>
<li>You should get a tap quite quickly</li>
</ul>
</section>
</section>
<section id="attacks-from-knee-ride" class="level2">
<h2 class="anchored" data-anchor-id="attacks-from-knee-ride">Attacks from knee ride</h2>
<section id="far-knee-spinning-arm-bar" class="level3">
<h3 class="anchored" data-anchor-id="far-knee-spinning-arm-bar">Far knee (spinning arm bar)</h3>
<ul>
<li><p>This one works when you’re in knee ride, and your opponent leaves the neck-protecting position to push on your knee with the hand that is furthest from the side you are on</p></li>
<li><p>Aha! You have an arm! Grab their tricep and pull towards you</p></li>
<li><p>Now place your other hand on the floor on the far side, far enough down their body that you can spin there</p></li>
<li><p>Sliding your hand up towards the wrist, pivot around so that you land under their armpit on the far side, as close to their body as you can manage</p></li>
<li><p>You should be in a position with your foot under their armpit</p></li>
<li><p>If you fall backward, let your arm go outward to avoid breaking their arm!</p></li>
<li><p>Now sit up again and grab their wrist with both hands</p></li>
<li><p>Keeping knees pinched together, lean slowly backwards until you get the tap, lifting hips if necessary</p></li>
<li><p><a href="https://youtu.be/ID3UY0tQkrM">Here is a good video of this technique</a></p></li>
</ul>
</section>
<section id="close-knee" class="level3">
<h3 class="anchored" data-anchor-id="close-knee">Close knee</h3>
</section>
<section id="cross-collar-choke-1" class="level3">
<h3 class="anchored" data-anchor-id="cross-collar-choke-1">Cross-collar choke</h3>
</section>
</section>
<section id="head-lock-escapes" class="level2">
<h2 class="anchored" data-anchor-id="head-lock-escapes">Head lock escapes</h2>
<ul>
<li><p>It isn’t usual in jiu jitsu for someone to have you in a head lock, but it’s a common situation in self defence</p></li>
<li><p>Fortunately it’s not hard to escape them!</p></li>
</ul>
<section id="if-they-havent-got-you-bent-over-too-much" class="level3">
<h3 class="anchored" data-anchor-id="if-they-havent-got-you-bent-over-too-much">If they haven’t got you bent over too much</h3>
<ul>
<li>Grab both their forearms to pull them away from your neck</li>
<li>Walk your legs forwards with bent knees until you are underneath your own shoulders</li>
<li>Now essentially do a single-leg takedown - step forwads, grab their leg, lift and spin</li>
</ul>
</section>
<section id="if-theyve-got-you-bent-right-over" class="level3">
<h3 class="anchored" data-anchor-id="if-theyve-got-you-bent-right-over">If they’ve got you bent right over</h3>
<ul>
<li>Whoops! But don’t panic</li>
<li>Again, grab both forearms</li>
<li>However, instead of walking under, now shoot your left leg forwards so that you slide into a sitting position</li>
<li>As you do this, roll them over you - it should feel quite easy, but careful of getting your arm squished</li>
</ul>
</section>
</section>
<section id="feet-on-hips" class="level2">
<h2 class="anchored" data-anchor-id="feet-on-hips">Feet on hips</h2>
<section id="double-ankle-sweep" class="level3">
<h3 class="anchored" data-anchor-id="double-ankle-sweep">Double ankle sweep</h3>
<ul>
<li>This one works when you have your feet on their hips, you have good grips, and they are standing with both feet close to your body, and they lean their weight backwards away from you.</li>
<li>Reach out and grab both their ankles firmly, then push them backwards with your feet.</li>
<li>They should fall onto their butt. Keep hold of their ankles.</li>
<li>Move your feet so that they are inside their hips</li>
<li>Pick a side and turn slightly onto that side, placing your far foot on the ground near their butt with your knee upwards</li>
<li>Push up onto your elbow and move your other foot UNDER that foot, then stand up</li>
<li>Don’t let go of their ankles! This will prevent them standing up</li>
<li>You are now ready to pass into knee ride and/or mount.</li>
</ul>
</section>
<section id="tripod-sweep" class="level3">
<h3 class="anchored" data-anchor-id="tripod-sweep">Tripod sweep</h3>
<ul>
<li>This is very similar to the above, but works when they are in a staggered stance, so you can’t grab both ankles. You can check by looking through your legs or over your shoulder.</li>
<li>Weight still has to be back</li>
<li>One ankle is enough!</li>
<li>Release your grip on the collar, grab the ankle, and hook your foot round the opposite knee</li>
<li>With the foot that is on the hip above the ankle you have grabbed, push outwards and sideways to sweep the person.</li>
<li>They should fall onto their butt. <em>Keep hold of their ankle</em>.</li>
<li>Move your feet so that they are inside their hips</li>
<li>Pick a side and turn slightly onto that side, placing your far foot on the ground near their butt with your knee upwards</li>
<li>Push up onto your elbow and move your other foot UNDER that foot, then stand up</li>
<li><em>Don’t let go of their ankle</em>! This will prevent them standing up</li>
<li>You are now ready to pass into knee ride and/or mount.</li>
</ul>
</section>
<section id="triangle-choke" class="level3">
<h3 class="anchored" data-anchor-id="triangle-choke">Triangle choke</h3>
<ul>
<li>This one works when their weight is forward, their head is lined up with yours, and you have an arm</li>
<li>Pull the arm sideways (straight) so they can’t brace on you</li>
<li>If they are trying to push forwards to squish your knees towards you, try putting a foot on a shoulder to push them back</li>
<li>Don’t push too far away from yourself! Keep knees above hips</li>
<li>Now lift your butt and hook the right foot (that was maybe on their shoulder) over their shoulder</li>
<li>Keep your grips for now!</li>
<li>Swivel your body to the right so that your head is away from theirs, and as you do this, your right foot should come around across their neck</li>
<li>Keep this foot down!!</li>
<li>Now hook your other knee over your shin. Needs to be <em>knee</em> not ankle! Otherwise you won’t get the choke!</li>
<li>Try not to lift the other foot as you attempt this. You may need to swing your leg outwards a little.</li>
<li>Now you are in a good position to do the triangle choke. (You have maybe let go of the lapel at this stage)</li>
<li>Squeeze your knees together until you get the tap</li>
</ul>
</section>
<section id="omoplata" class="level3">
<h3 class="anchored" data-anchor-id="omoplata">Omoplata</h3>
<ul>
<li><p>This one works when their weight is forward, you have their arm, and their head is OFF alignment with yours on the side away from their arm</p></li>
<li><p>With the leg that’s on the opposite side to their head, kick upwards under their armpit, enfolding their shoulder and folding them over</p></li>
<li><p>As you do this, you should be able to sit up with the momentum of your leg</p></li>
<li><p>Now you’re sitting up and you have their shoulder</p></li>
<li><p>Scoot around in a circle till you’re aligned with their body (TIGHT circle)</p></li>
<li><p>Lean forwards to flatten them out (I’m a bit hazy on this bit)</p></li>
<li><p><a href="https://www.youtube.com/watch?v=0Vd2OGXHkso&amp;ab_channel=BlackDragonBJJ%2FCobraKaiKarateDungannon">Here is the closest video I’ve been able to find of this version</a></p></li>
</ul>
</section>
<section id="arm-bar-1" class="level3">
<h3 class="anchored" data-anchor-id="arm-bar-1">Arm bar</h3>
<ul>
<li>This one works when their weight is forward, you have their arm, and their head is OFF alignment with yours <strong>on the same side as their arm</strong></li>
<li>This won’t happen very often on its own but may be a reaction to something else</li>
<li>First lift your right leg up (the one on the same side as their arm) onto their back as if rock climbing up - your hips are now off the ground</li>
<li>This will have turned your body a little already</li>
<li>Now turn your body further and lift the other leg over their head, clamping down over their neck, heels down, toes up</li>
<li>You now have their arm in the classic arm bar position</li>
<li>Move hands to their wrist (at least one hand needs to be touching the top of their hand) and extend the arm a little</li>
<li>Pinch knees together and slowly lift hips to finish the arm bar</li>
<li>Be sure to pay attention to the angle - move upwards towards you knee</li>
<li><strong>Side note</strong> if they try to stack you, there are some things you can do
<ul>
<li>Don’t let them - lock your knee in place</li>
<li>You can shoulder walk back till your knee is at right angles again</li>
<li>If they’re really stacking you, you can reach your right hand across to the <strong>opposite</strong> foot and grab it, then pull yourself underneath them - as they unbalance, you will land in the classic mount arm bar</li>
</ul></li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>